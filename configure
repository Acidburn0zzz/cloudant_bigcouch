#!/bin/bash

function quit {
  exit
}

PREFIX="/opt"
DATA="/srv/db"
VIEW="/srv/view_index"
DBCORE_USER=`whoami`

while [ $# -gt 0 ]
do
  case $1
  in
    -p)
      PREFIX=$2
      shift 2
    ;;
    -t)
      TEMPLATE=$2
      shift 2
    ;;
    -d)
      DATA=$2
      shift 2
    ;;
    -v)
      VIEW=$2
      shift 2
    ;;
    -u)
      DBCORE_USER=$2
      shift 2
    ;;
    *)
      echo "usage: $0 [-p {prefix} -t {template} -d {data_dir} -v {view_dir} -u {user}]"
      quit
    ;;
  esac
done

echo "==> configuring dbcore in rel/overlay.config"
cat > rel/overlay.config << EOF
{prefix, "$PREFIX"}.
{core_dir, "$PREFIX/dbcore"}.
{data_dir, "$DATA"}.
{view_dir, "$VIEW"}.
{user, "$DBCORE_USER"}.
EOF

cat > install.mk << EOF
# The contents of this file are auto-generated by configure
prefix = $PREFIX
data_dir = $DATA
view_dir = $VIEW
user = $DBCORE_USER
EOF

cat rel/overlay.config
